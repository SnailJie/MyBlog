{% extends "base/front.html" %}

{% block title %}创作文章{% endblock %}
{% block head %}
 <!-- 引入wangEditor.css,后期再增加MarkDown编辑器 -->
 <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='wangEditor/css/wangEditor.min.css') }}">
 {% endblock %}
 
 {% block PathNavigation %}
 <!-- 导航 -->
            <ul class="breadcrumb">
                <li> <a href="{{ url_for('front.index') }}">首页</a> </li>
                <li class="active">创作</li>
            </ul>
{% endblock %}

{% block container %}

<form class="form-horizontal" role="form" id="CreateBlogFormId">
                <center><h3>
                    <scan class="help-block"><i class="icon-pencil icon-1x"></i>&nbsp;创作文章
                    <input type="button" onclick=postForm() value="提交文章" class="btn btn-success btn-xs" />
                    <a href="{{ url_for('front.blogWrite', editor='wangEditor') }}" class="btn btn-info btn-xs" role="button">&nbsp;切换编辑器</a>
                    </scan>
                </h3></center>
                <div class="form-group">
                    <label for="blogTitle" class="col-sm-2 control-label"><i class="icon-ok-sign"></i>&nbsp;文章标题</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="blogTitle" name="title" placeholder="请在此处填写文章标题" />
                    </div>
                </div>
                <div class="form-group">
                    <label for="blogTag" class="col-sm-2 control-label"><i class="icon-tags"></i>&nbsp;文章标签</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="blogTag" name="tag" placeholder="请在此处输入标签并以空格分割" />
                    </div>
                </div>
                <div class="form-group">
                    <label for="blogCatalog" class="col-sm-2 control-label"><i class="icon-folder-open"></i>&nbsp;文章分类</label>
                    <div class="col-sm-10">
                        <select class="form-control" id="blogCatalog" name="catalog">
                            <option>未分类</option>
                            <option>JAVA</option>
                            <option>C++</option>
                            <option>架构</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="blogSource" class="col-sm-2 control-label"><i class="icon-info-sign"></i>&nbsp;文章来源</label>
                    <div class="col-sm-10">
                        <label class="radio-inline">
                            <input type="radio" name="sources" value="原创" checked="checked">原创
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="sources" value="转载">转载 
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="sources" value="翻译">翻译
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <textarea class="form-control" id="editor" style="height:600px; max-height:700px; width: 100%" name="content">请输入文章内容...</textarea>
                </div>
                <div class="form-group">
                    <input type="hidden" class="form-control" name="author" value="Jaren">
                </div>
                <div class="form-group">
                    <input type="hidden" class="form-control" name="editor" value="wangEditor">
                </div>
            </form>
 {% endblock container %}
 
 {% block script %}
  <!--引入jquery和wangEditor.js-->
    <script type="text/javascript" src="{{ url_for('static', filename='wangEditor/js/wangEditor.min.js') }}"></script>
    <script type="text/javascript">
        // 获取元素
        var div = document.getElementById('editor');
        // 生成编辑器
        var editor = new wangEditor(div);
        // 为当前的editor配置密钥
        editor.config.mapAk = 'rsG1HfOkrldOGdI53TMI9rAdxGuzb0PI';
        // 取消粘贴过滤
        editor.config.pasteFilter = true;
        // 插入代码时的默认语言
        editor.config.codeDefaultLang = 'python';
       
        // 创建编辑器
        editor.create();
    </script>
    
    
    
<script type="text/javascript">
    // 提交文章数据
    function postForm() {
        
        blog = $('#CreateBlogFormId').serialize();
        console.debug(blog);
        $.ajax({
            url: '{{ url_for("api.blog") }}',
            method: 'POST',
            datatype: 'json',
            data: blog,
            success: function(res) {
                console.log(res);
                if (res.code == 0){
                    layer.msg("提交文章成功！", {icon: 1, time: 3*1000})
                    if ( isNaN(res.data) ) {
                        location.reload(true);
                    } else {
                        window.location="/blog/" + res.data + ".html";
                    }
                } else {
                    layer.msg("提交文章失败，请重试提交或报告错误！\n错误原因是：" + res.msg, {icon: 2, time: 15*1000});
                }
            },
        });          
    };
</script>

{% endblock script %}
   
   